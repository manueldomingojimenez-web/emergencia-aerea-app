<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Demo Altas / Consultas / Dashboard</title>
<style>
/* ===========================
   CSS (incluye tu hoja + ajustes)
   =========================== */
:root {
    --primary-color: #2c3e50;
    --secondary-color: #3498db;
    --accent-color: #e74c3c;
    --success-color: #27ae60;
    --warning-color: #f39c12;
    --light-gray: #ecf0f1;
    --medium-gray: #bdc3c7;
    --dark-gray: #7f8c8d;
    --text-color: #2c3e50;
    --background-color: #f8f9fa;
    --white: #ffffff;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: var(--text-color);
    line-height: 1.6;
    min-height: 100vh;
}

#app { min-height: 100vh; display: flex; flex-direction: column; }

/* HEADER */
.app-header {
    background: var(--white);
    color: var(--primary-color);
    padding: 1rem 2rem;
    display: flex; justify-content: space-between; align-items: center;
    box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    border-bottom: 4px solid var(--secondary-color);
}
.app-header h1 { font-size: 1.5rem; font-weight: 700; }
.user-info { font-size: 0.9rem; color: var(--dark-gray); font-weight: 500; }

/* PESTAÃ‘AS PRINCIPALES */
.main-tabs {
    display: flex; background: var(--white);
    border-bottom: 2px solid var(--secondary-color);
    padding: 0 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.tab-btn {
    padding: 1rem 2rem; border: none; background: transparent; cursor: pointer;
    font-size: 1rem; font-weight: 600; color: var(--dark-gray);
    border-bottom: 3px solid transparent; transition: all 0.3s ease; position: relative;
}
.tab-btn:hover { background: var(--light-gray); color: var(--primary-color); }
.tab-btn.active, .tab-btn.active:hover {
    color: var(--secondary-color); border-bottom-color: var(--secondary-color); background: var(--white);
}

/* CONTENIDO PRINCIPAL */
.app-main { flex: 1; padding: 2rem; max-width: 1400px; margin: 0 auto; width: 100%; }
.tab-content { display: none; animation: fadeIn 0.5s ease; }
.tab-content.active { display: block; }
@keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }

/* CONTENEDOR ALTAS */
.alta-container {
    background: var(--white); border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.12); overflow: hidden;
}
.alta-container h2 {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: var(--white); padding: 1.5rem 2rem; margin: 0; font-size: 1.4rem;
}

/* PROGRESO DE PASOS */
.progreso-pasos {
    display: flex; justify-content: center; padding: 2rem;
    background: var(--light-gray); border-bottom: 1px solid var(--medium-gray);
}
.paso {
    display: flex; flex-direction: column; align-items: center;
    padding: 0 2rem; position: relative; cursor: pointer; transition: all 0.3s ease;
}
.paso:not(:last-child)::after {
    content: ''; position: absolute; top: 25px; right: -10px; width: 20px; height: 2px; background: var(--medium-gray);
}
.numero-paso {
    width: 50px; height: 50px; border-radius: 50%; background: var(--medium-gray);
    color: var(--white); display:flex; align-items:center; justify-content:center;
    font-weight: bold; margin-bottom: .5rem; transition: all .3s ease; border: 3px solid var(--medium-gray);
}
.texto-paso { font-size: .9rem; color: var(--dark-gray); font-weight: 500; transition: all .3s ease; }
.paso.activo .numero-paso { background: var(--secondary-color); border-color: var(--secondary-color); transform: scale(1.1); }
.paso.activo .texto-paso { color: var(--secondary-color); font-weight: 600; }
.paso.completado .numero-paso { background: var(--success-color); border-color: var(--success-color); }
.paso.completado::after { background: var(--success-color); }

/* PestaÃ±a bloqueada (aÃ±adida) */
.paso.bloqueado { opacity: .5; pointer-events: none; }
.paso.bloqueado .numero-paso { background: var(--medium-gray); border-color: var(--medium-gray); }
.paso.completado .texto-paso { color: var(--success-color); font-weight: 600; }

/* PESTAÃ‘AS INTERNAS */
.pestanas-internas {
    display: flex; background: var(--light-gray); border-bottom: 1px solid var(--medium-gray); padding: 0 2rem;
}
.pestana-interna {
    padding: 1rem 2rem; border: none; background: transparent; cursor: pointer;
    font-size: .9rem; font-weight: 600; color: var(--dark-gray);
    border-bottom: 3px solid transparent; transition: all .3s ease;
}
.pestana-interna.activa { color: var(--secondary-color); border-bottom-color: var(--secondary-color); background: var(--white); }
.contenido-pestana { display: none; padding: 2rem; }
.contenido-pestana.activa { display: block; }

/* FORMULARIOS POR PASOS */
.form-paso { display: none; }
.form-paso.activo { display: block; animation: slideIn .5s ease; }
@keyframes slideIn { from {opacity:0; transform:translateX(20px);} to {opacity:1; transform:translateX(0);} }
.form-paso h3 { color: var(--primary-color); margin-bottom: 1.5rem; padding: 0 2rem; padding-top: 2rem; font-size: 1.3rem; }

.form-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(300px,1fr));
    gap: 1.5rem; margin-bottom: 2rem;
}
.form-group { display:flex; flex-direction: column; }
.form-group label { margin-bottom: .5rem; font-weight: 600; color: var(--text-color); font-size: .9rem; }
/* Sugerencia: aplica .required al label en lugar de required al label nativo */
.form-group label.required::after { content: " *"; color: var(--accent-color); }

.form-input {
    padding: .75rem 1rem; border: 2px solid var(--light-gray); border-radius: 6px;
    font-size: 1rem; transition: all .3s ease; width: 100%; background: var(--white);
}
.form-input:focus { outline:none; border-color: var(--secondary-color); box-shadow: 0 0 0 3px rgba(52,152,219,.1); background: var(--white); }
.form-input:disabled { background:#f8f9fa; color: var(--dark-gray); cursor: not-allowed; border-color: var(--light-gray); }

.checkbox-group { flex-direction: row; align-items:center; gap: .5rem; }
.checkbox-label { display:flex; align-items:center; gap:.5rem; cursor:pointer; margin-bottom:0; font-weight:500; }
.checkbox-label input[type="checkbox"] { width:18px; height:18px; }

select.form-input[multiple] { height: 120px; padding: .5rem; background: var(--white); }
select.form-input[multiple] option { padding: .5rem; margin: 2px 0; }

/* ACCIONES DE PASO */
.acciones-paso {
    display:flex; justify-content: space-between; align-items:center;
    padding: 2rem; border-top: 1px solid var(--light-gray); margin-top: 1rem; background: var(--light-gray);
}
.btn-anterior, .btn-siguiente, .btn-guardar, .btn-validar {
    padding: .75rem 2rem; border:none; border-radius:6px; cursor:pointer; font-size:1rem; font-weight:600;
    transition: all .3s ease; display:flex; align-items:center; gap:.5rem;
}
.btn-anterior { background: var(--medium-gray); color: var(--white); }
.btn-anterior:hover { background: var(--dark-gray); }
.btn-siguiente, .btn-validar { background: var(--success-color); color: var(--white); }
.btn-siguiente:hover, .btn-validar:hover { background:#229954; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(34,153,84,.3); }
.btn-guardar { background: var(--secondary-color); color: var(--white); }
.btn-guardar:hover { background:#2980b9; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(52,152,219,.3); }

/* Guardar oculto base; JS lo muestra cuando toca */
#btnGuardarFinal { display: none; }

/* RESUMEN CONFIRMACIÃ“N */
.resumen-datos { padding: 0 2rem; }
.resumen-seccion {
    margin-bottom:2rem; padding:1.5rem; background: var(--light-gray);
    border-radius:8px; border-left:4px solid var(--secondary-color);
}
.resumen-seccion h4 { color: var(--primary-color); margin-bottom:1rem; font-size:1.1rem; }
.resumen-grid {
    display:grid; grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); gap:1rem;
}
.resumen-item { padding:.5rem 0; border-bottom:1px solid var(--medium-gray); }
.resumen-item:last-child { border-bottom:none; }
.resumen-item strong { color: var(--primary-color); display:inline-block; min-width:150px; }

/* RESPONSIVE */
@media (max-width: 768px) {
    .app-header { flex-direction: column; gap: 1rem; text-align:center; padding:1rem; }
    .main-tabs { flex-direction: column; padding: 0; }
    .tab-btn { padding: 1rem; border-bottom: 1px solid var(--light-gray); }
    .app-main { padding: 1rem; }
    .progreso-pasos { flex-direction: column; gap: 1rem; padding: 1rem; }
    .paso:not(:last-child)::after { display:none; }
    .pestanas-internas { flex-direction: column; padding: 0; }
    .pestana-interna { padding: 1rem; border-bottom: 1px solid var(--medium-gray); }
    .form-grid { grid-template-columns: 1fr; }
    .contenido-pestana { padding: 1rem; }
    .acciones-paso { flex-direction: column; gap: 1rem; }
    .btn-anterior, .btn-siguiente, .btn-guardar, .btn-validar { width: 100%; justify-content: center; }
    .resumen-grid { grid-template-columns: 1fr; }
}

/* FOOTER */
.app-footer {
    background: var(--primary-color); color: var(--white);
    text-align: center; padding: 1.5rem; margin-top: auto;
}
</style>
</head>
<body>
<div id="app">
  <header class="app-header">
    <h1>GestiÃ³n de Altas</h1>
    <div class="user-info">Demo â€¢ Madrid 112</div>
  </header>

  <!-- Tabs principales -->
  <nav class="main-tabs">
    <button class="tab-btn active" data-tab="Altas">Altas</button>
    <button class="tab-btn" data-tab="Consultas">BÃºsquedas / Consultas</button>
    <button class="tab-btn" data-tab="Dashboard">Dashboard</button>
  </nav>

  <main class="app-main">
    <!-- TAB ALTAS -->
    <section id="Altas" class="tab-content active">
      <div class="alta-container">
        <h2>Alta de familiar y afectado</h2>

        <!-- Progreso de pasos -->
        <div class="progreso-pasos">
          <div class="paso demo-activo activo" data-paso="1">
            <div class="numero-paso">1</div>
            <div class="texto-paso">Familiar</div>
          </div>
          <div class="paso demo-activo bloqueado" data-paso="2">
            <div class="numero-paso">2</div>
            <div class="texto-paso">Afectado</div>
          </div>
          <div class="paso demo-activo bloqueado" data-paso="3">
            <div class="numero-paso">3</div>
            <div class="texto-paso">ConfirmaciÃ³n</div>
          </div>
        </div>

        <!-- PASO 1: FAMILIAR -->
        <div id="paso-familiar" class="form-paso activo">
          <h3>Datos del familiar</h3>

          <!-- SubpestaÃ±as internas del familiar -->
          <div class="pestanas-internas">
            <button class="pestana-interna activa" data-pestana="familiar-1">IdentificaciÃ³n</button>
            <button class="pestana-interna" data-pestana="familiar-2">Contacto</button>
          </div>

          <div id="familiar-1" class="contenido-pestana activa">
            <div class="form-grid">
              <div class="form-group">
                <label class="required" for="famNombre">Nombre</label>
                <input id="famNombre" class="form-input" type="text" placeholder="Nombre" />
              </div>
              <div class="form-group">
                <label class="required" for="famApellidos">Apellidos</label>
                <input id="famApellidos" class="form-input" type="text" placeholder="Apellidos" />
              </div>
              <div class="form-group">
                <label for="famDNI">DNI / NIE</label>
                <input id="famDNI" class="form-input" type="text" placeholder="12345678A" />
              </div>
            </div>
          </div>

          <div id="familiar-2" class="contenido-pestana">
            <div class="form-grid">
              <div class="form-group">
                <label class="required" for="famTelefono">TelÃ©fono</label>
                <input id="famTelefono" class="form-input" type="tel" placeholder="+34 6XX..." />
              </div>
              <div class="form-group">
                <label for="famEmail">Email</label>
                <input id="famEmail" class="form-input" type="email" placeholder="email@dominio.com" />
              </div>
              <div class="form-group">
                <label for="famRelacion">RelaciÃ³n</label>
                <input id="famRelacion" class="form-input" type="text" placeholder="Padre/Madre/Hijo..." />
              </div>
            </div>
          </div>

          <div class="acciones-paso">
            <div></div>
            <div style="display:flex; gap: .75rem;">
              <button id="btnValidarFamiliar" class="btn-validar">Validar Familiar</button>
              <button id="btnSiguienteAfectado" class="btn-siguiente">Ir a Afectado</button>
            </div>
          </div>
        </div>

        <!-- PASO 2: AFECTADO -->
        <div id="paso-afectado" class="form-paso">
          <h3>Datos del afectado</h3>

          <div class="pestanas-internas">
            <button class="pestana-interna activa" data-pestana="afectado-1">IdentificaciÃ³n</button>
            <button class="pestana-interna" data-pestana="afectado-2">SituaciÃ³n</button>
          </div>

          <div id="afectado-1" class="contenido-pestana activa">
            <div class="form-grid">
              <div class="form-group">
                <label class="required" for="afeNombre">Nombre</label>
                <input id="afeNombre" class="form-input" type="text" placeholder="Nombre" />
              </div>
              <div class="form-group">
                <label class="required" for="afeApellidos">Apellidos</label>
                <input id="afeApellidos" class="form-input" type="text" placeholder="Apellidos" />
              </div>
              <div class="form-group">
                <label for="afeDoc">Documento</label>
                <input id="afeDoc" class="form-input" type="text" placeholder="Pasaporte / DNI" />
              </div>
            </div>
          </div>

          <div id="afectado-2" class="contenido-pestana">
            <div class="form-grid">
              <div class="form-group">
                <label for="afeEdad">Edad</label>
                <input id="afeEdad" class="form-input" type="number" min="0" max="120" />
              </div>
              <div class="form-group">
                <label for="afeEstado">Estado</label>
                <input id="afeEstado" class="form-input" type="text" placeholder="Localizado / Desaparecido / Lesionado..." />
              </div>
              <div class="form-group">
                <label for="afeNotas">Notas</label>
                <input id="afeNotas" class="form-input" type="text" placeholder="Observaciones" />
              </div>
            </div>
          </div>

          <div class="acciones-paso">
            <button class="btn-anterior" onclick="window.app.mostrarPaso(1)">Volver a Familiar</button>
            <div style="display:flex; gap: .75rem;">
              <button id="btnValidarAfectado" class="btn-validar">Validar Afectado</button>
              <button id="btnSiguienteConfirmacion" class="btn-siguiente">Ir a ConfirmaciÃ³n</button>
            </div>
          </div>
        </div>

        <!-- PASO 3: CONFIRMACIÃ“N -->
        <div id="paso-confirmacion" class="form-paso">
          <h3>ConfirmaciÃ³n de datos</h3>
          <div class="resumen-datos">
            <div class="resumen-seccion">
              <h4>Familiar</h4>
              <div class="resumen-grid">
                <div class="resumen-item"><strong>Nombre:</strong> <span id="rFamNombre">â€”</span></div>
                <div class="resumen-item"><strong>Apellidos:</strong> <span id="rFamApellidos">â€”</span></div>
                <div class="resumen-item"><strong>TelÃ©fono:</strong> <span id="rFamTelefono">â€”</span></div>
                <div class="resumen-item"><strong>Email:</strong> <span id="rFamEmail">â€”</span></div>
                <div class="resumen-item"><strong>RelaciÃ³n:</strong> <span id="rFamRelacion">â€”</span></div>
              </div>
            </div>

            <div class="resumen-seccion">
              <h4>Afectado</h4>
              <div class="resumen-grid">
                <div class="resumen-item"><strong>Nombre:</strong> <span id="rAfeNombre">â€”</span></div>
                <div class="resumen-item"><strong>Apellidos:</strong> <span id="rAfeApellidos">â€”</span></div>
                <div class="resumen-item"><strong>Documento:</strong> <span id="rAfeDoc">â€”</span></div>
                <div class="resumen-item"><strong>Edad:</strong> <span id="rAfeEdad">â€”</span></div>
                <div class="resumen-item"><strong>Estado:</strong> <span id="rAfeEstado">â€”</span></div>
                <div class="resumen-item"><strong>Notas:</strong> <span id="rAfeNotas">â€”</span></div>
              </div>
            </div>
          </div>

          <div class="acciones-paso">
            <button class="btn-anterior" onclick="window.app.mostrarPaso(2)">Volver a Afectado</button>
            <button id="btnGuardarFinal" class="btn-guardar">Guardar</button>
          </div>
        </div>
      </div>
    </section>

    <!-- TAB CONSULTAS -->
    <section id="Consultas" class="tab-content">
      <div class="alta-container">
        <h2>Consultas</h2>
        <div style="padding: 2rem;">
          <div class="form-grid">
            <div class="form-group">
              <label class="required" for="txtBuscar">Buscar</label>
              <input id="txtBuscar" class="form-input" placeholder="Nombre / Apellidos / DNI / TelÃ©fono" />
            </div>
          </div>
          <div id="consultaResultados">Resultados aquÃ­ (demo)</div>
        </div>
      </div>
    </section>

    <!-- TAB DASHBOARD -->
    <section id="Dashboard" class="tab-content">
      <div class="alta-container">
        <h2>Dashboard</h2>
        <div style="padding: 2rem;">
          <p>Total familiares: <strong id="kpiFam">0</strong></p>
          <p>Total afectados: <strong id="kpiAfe">0</strong></p>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    Â© Demo â€” Flujo de validaciÃ³n y guardado
  </footer>
</div>

<script>
/* ===========================
   JS mejorado (con gating)
   =========================== */
class DemoApp {
  constructor() {
    this.pasoActual = 1;
    this.familiarValid = false;
    this.afectadoValid = false;

    // KPIs demo
    this.totalFam = 0;
    this.totalAfe = 0;

    this.init();
  }

  init() {
    this.setupEventListeners();
    this.mostrarPestana("Altas");
    this.mostrarPaso(1);
    this.actualizarUIEstado();
    console.log("âœ… Demo app inicializada");
  }

  qs(sel){ return document.querySelector(sel); }
  qsa(sel){ return Array.from(document.querySelectorAll(sel)); }

  setupEventListeners() {
    // Tabs principales
    this.qsa(".tab-btn").forEach(btn => {
      btn.addEventListener("click", (e) => {
        const tab = e.currentTarget?.dataset?.tab;
        if (tab) this.mostrarPestana(tab);
      });
    });

    // Stepper
    this.qsa(".paso").forEach(paso => {
      paso.addEventListener("click", (e) => {
        const nuevoPaso = parseInt(e.currentTarget?.dataset?.paso || "0", 10);
        if (!nuevoPaso) return;
        if (nuevoPaso === 2 && !this.familiarValid) {
          alert("âš ï¸ Debes validar el Familiar antes de pasar a Afectado.");
          return;
        }
        if (nuevoPaso === 3 && !(this.familiarValid && this.afectadoValid)) {
          alert("âš ï¸ Debes validar Familiar y Afectado antes de ConfirmaciÃ³n.");
          return;
        }
        this.mostrarPaso(nuevoPaso);
      });
    });

    // SubpestaÃ±as
    this.qsa(".pestana-interna").forEach(pestana => {
      pestana.addEventListener("click", (e) => {
        const id = e.currentTarget?.dataset?.pestana;
        if (id) this.mostrarPestanaInterna(id);
      });
    });

    // Botones acciÃ³n
    this.qs("#btnValidarFamiliar")?.addEventListener("click", () => this.validarFamiliar());
    this.qs("#btnSiguienteAfectado")?.addEventListener("click", () => this.mostrarPaso(2));
    this.qs("#btnValidarAfectado")?.addEventListener("click", () => this.validarAfectado());
    this.qs("#btnSiguienteConfirmacion")?.addEventListener("click", () => this.mostrarPaso(3));
    this.qs("#btnGuardarFinal")?.addEventListener("click", () => this.guardarRegistro());
  }

  mostrarPestana(tabName) {
    this.qsa(".tab-btn").forEach(btn => btn.classList.remove("active"));
    this.qsa(".tab-content").forEach(tab => tab.classList.remove("active"));
    this.qs(`[data-tab="${tabName}"]`)?.classList.add("active");
    this.qs(`#${tabName}`)?.classList.add("active");
  }

  mostrarPaso(numeroPaso) {
    this.pasoActual = numeroPaso;

    // Reset estados visuales
    this.qsa(".paso").forEach(p => p.classList.remove("activo", "completado", "bloqueado"));

    // Completados segÃºn flags
    if (this.familiarValid) this.qs(`[data-paso="1"]`)?.classList.add("completado");
    if (this.afectadoValid) this.qs(`[data-paso="2"]`)?.classList.add("completado");

    // Bloqueos segÃºn estado
    if (!this.familiarValid) this.qs(`[data-paso="2"]`)?.classList.add("bloqueado");
    if (!(this.familiarValid && this.afectadoValid)) this.qs(`[data-paso="3"]`)?.classList.add("bloqueado");

    // Activo actual
    this.qs(`[data-paso="${numeroPaso}"]`)?.classList.add("activo");

    // Mostrar contenido del paso
    this.qsa(".form-paso").forEach(p => p.classList.remove("activo"));
    this.qs(`#paso-${this.getPasoName(numeroPaso)}`)?.classList.add("activo");

    // Al entrar en 1, mostrar primera subpestaÃ±a por defecto
    if (numeroPaso === 1) this.mostrarPestanaInterna("familiar-1");
    if (numeroPaso === 2) this.mostrarPestanaInterna("afectado-1");

    // Si paso 3, refrescar resumen
    if (numeroPaso === 3) this.refrescarResumen();

    this.actualizarUIEstado();
  }

  getPasoName(n){ return ({1:"familiar",2:"afectado",3:"confirmacion"})[n]; }

  mostrarPestanaInterna(id) {
    this.qsa(".pestana-interna").forEach(p => p.classList.remove("activa"));
    this.qsa(`.pestana-interna[data-pestana="${id}"]`)?.classList.add("activa");
    this.qsa(".contenido-pestana").forEach(c => c.classList.remove("activa"));
    this.qs(`#${id}`)?.classList.add("activa");
  }

  validarFamiliar() {
    // AquÃ­ podrÃ­as validar realmente (campos vacÃ­os, formato, etc.)
    // Demo simple: nombre + apellidos + telÃ©fono requeridos
    const ok =
      this.qs("#famNombre")?.value?.trim() &&
      this.qs("#famApellidos")?.value?.trim() &&
      this.qs("#famTelefono")?.value?.trim();

    if (!ok) {
      alert("âš ï¸ Completa Nombre, Apellidos y TelÃ©fono del Familiar.");
      this.familiarValid = false;
      this.actualizarUIEstado();
      return;
    }

    this.familiarValid = true;
    alert("âœ… Familiar validado correctamente.");
    this.actualizarUIEstado();
  }

  validarAfectado() {
    if (!this.familiarValid) {
      alert("âš ï¸ Primero valida el Familiar.");
      return;
    }

    // Demo: nombre + apellidos requeridos
    const ok =
      this.qs("#afeNombre")?.value?.trim() &&
      this.qs("#afeApellidos")?.value?.trim();

    if (!ok) {
      alert("âš ï¸ Completa Nombre y Apellidos del Afectado.");
      this.afectadoValid = false;
      this.actualizarUIEstado();
      return;
    }

    this.afectadoValid = true;
    alert("âœ… Afectado validado correctamente.");
    this.actualizarUIEstado();
  }

  refrescarResumen() {
    // Familiar
    this.qs("#rFamNombre").textContent = this.qs("#famNombre")?.value || "â€”";
    this.qs("#rFamApellidos").textContent = this.qs("#famApellidos")?.value || "â€”";
    this.qs("#rFamTelefono").textContent = this.qs("#famTelefono")?.value || "â€”";
    this.qs("#rFamEmail").textContent = this.qs("#famEmail")?.value || "â€”";
    this.qs("#rFamRelacion").textContent = this.qs("#famRelacion")?.value || "â€”";

    // Afectado
    this.qs("#rAfeNombre").textContent = this.qs("#afeNombre")?.value || "â€”";
    this.qs("#rAfeApellidos").textContent = this.qs("#afeApellidos")?.value || "â€”";
    this.qs("#rAfeDoc").textContent = this.qs("#afeDoc")?.value || "â€”";
    this.qs("#rAfeEdad").textContent = this.qs("#afeEdad")?.value || "â€”";
    this.qs("#rAfeEstado").textContent = this.qs("#afeEstado")?.value || "â€”";
    this.qs("#rAfeNotas").textContent = this.qs("#afeNotas")?.value || "â€”";
  }

  guardarRegistro() {
    if (!(this.familiarValid && this.afectadoValid)) {
      alert("âš ï¸ Debes validar Familiar y Afectado antes de guardar.");
      return;
    }

    // AquÃ­ irÃ­a tu POST/Patch a SharePoint/PowerApps/etc.
    alert("ðŸ’¾ DEMO: Registro guardado correctamente.");

    // KPIs demo
    this.totalFam += 1;
    this.totalAfe += 1;
    this.qs("#kpiFam").textContent = this.totalFam;
    this.qs("#kpiAfe").textContent = this.totalAfe;

    // Reset flujo para nueva alta
    this.familiarValid = false;
    this.afectadoValid = false;

    // Limpieza rÃ¡pida de inputs (demo)
    ["famNombre","famApellidos","famDNI","famTelefono","famEmail","famRelacion",
     "afeNombre","afeApellidos","afeDoc","afeEdad","afeEstado","afeNotas"]
     .forEach(id => { const el = this.qs("#"+id); if (el) el.value = ""; });

    this.mostrarPaso(1);
  }

  actualizarUIEstado() {
    // Guardar solo cuando ambos validados
    const btnGuardar = this.qs("#btnGuardarFinal");
    if (btnGuardar) btnGuardar.style.display = (this.familiarValid && this.afectadoValid) ? "inline-flex" : "none";

    // Bloqueos visuales + puntero en pasos
    this.qsa(".paso").forEach(p => {
      const pasoNum = parseInt(p.dataset.paso || "0", 10);
      let bloqueado = false;
      if (pasoNum === 2 && !this.familiarValid) bloqueado = true;
      if (pasoNum === 3 && !(this.familiarValid && this.afectadoValid)) bloqueado = true;
      p.classList.toggle("bloqueado", bloqueado);
      p.style.pointerEvents = bloqueado ? "none" : "auto";
    });

    // Marcar completados segÃºn flags
    this.qs(`[data-paso="1"]`)?.classList.toggle("completado", this.familiarValid);
    this.qs(`[data-paso="2"]`)?.classList.toggle("completado", this.afectadoValid);
  }
}

document.addEventListener("DOMContentLoaded", () => { window.app = new DemoApp(); });
</script>
</body>
</html>
